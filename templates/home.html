<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Explorador de Archivos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* Estilos espec√≠ficos para el Buscador y Sugerencias */
        .search-container {
            position: relative;
            max-width: 500px;
            margin: 0 auto 20px auto;
        }

        .search-box {
            display: flex;
            gap: 10px;
        }

        .search-input {
            flex-grow: 1;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 16px;
        }

        /* Lista de sugerencias flotante */
        .suggestions-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 5px 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            list-style: none;
            padding: 0;
            margin: 0;
            z-index: 1000;
            display: none; /* Oculto por defecto */
        }

        .suggestions-list li {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }

        .suggestions-list li:hover {
            background-color: #f1f1f1;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Pagina de Inicio üß†</h1>
        
        <div style="text-align: right; margin-bottom: 15px;">
            {% if current_user.is_authenticated %}
                <span>Hola, <b>{{ current_user.username }}</b></span> | 
                <a href="/dashboard">Ir a mi Panel</a>
            {% else %}
                <a href="/login">Iniciar Sesi√≥n</a>
            {% endif %}
        </div>

        <div class="search-container">
            <div class="search-box">
                <input type="text" id="searchInput" class="search-input" placeholder="Escribe para buscar (ej: 'dcumento')..." autocomplete="off">
            </div>
            <ul id="suggestions" class="suggestions-list"></ul>
        </div>

        <hr>

        <h3>üìÇ Archivos Recientes</h3>
        <ul id="filesList">
            {% for file in files %}
                <li>
                    <span>
                        {% if file.is_public %} üåç {% else %} üîí {% endif %}
                        <strong>{{ file.filename }}</strong> 
                        <br><small style="color: grey;">Subido por: {{ file.owner.username }}</small>
                    </span>
                    <a href="{{ url_for('download', file_id=file.id) }}">
                        <button class="btn-download">Descargar</button>
                    </a>
                </li>
            {% else %}
                <p style="text-align: center; color: #777;">No hay archivos para mostrar.</p>
            {% endfor %}
        </ul>
    </div>

    <script>
        const input = document.getElementById('searchInput');
        const suggestionsBox = document.getElementById('suggestions');

        // Escuchar cada vez que el usuario levanta una tecla
        input.addEventListener('keyup', function() {
            const query = input.value;

            if (query.length < 2) {
                suggestionsBox.style.display = 'none';
                return;
            }

            // Llamar al servidor (API)
            fetch(`/api/search_suggestions?q=${query}`)
                .then(response => response.json())
                .then(data => {
                    suggestionsBox.innerHTML = ''; // Limpiar lista anterior
                    
                    if (data.length > 0) {
                        suggestionsBox.style.display = 'block';
                        
                        data.forEach(item => {
                            const li = document.createElement('li');
                            // Mostrar nombre y un bot√≥n peque√±o de descarga directa
                            li.innerHTML = `
                                <span>${item.filename}</span>
                                <small style="color:#aaa">Coincidencia: ${item.score}%</small>
                            `;
                            
                            // Al hacer clic en la sugerencia, descargamos directamente o rellenamos
                            li.onclick = function() {
                                window.location.href = `/download/${item.id}`;
                            };
                            
                            suggestionsBox.appendChild(li);
                        });
                    } else {
                        suggestionsBox.style.display = 'none';
                    }
                });
        });

        // Ocultar sugerencias si hago clic fuera
        document.addEventListener('click', function(e) {
            if (e.target !== input) {
                suggestionsBox.style.display = 'none';
            }
        });
    </script>
</body>
</html>